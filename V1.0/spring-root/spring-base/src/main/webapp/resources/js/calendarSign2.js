
(function(a){a.fn.calendarSign=function(g){var w=new Date();var k=w.getFullYear();var y=w.getMonth()+1;var p=(y<10)?"0"+y:y;var t=w.getDate();var s=[];var j={};var d=50;var i={year:k,month:y,tableClass:"sign-succ-table",headClass:"",headTrClass:"sign-succ-canlerdar-head",bodyClass:"sign-succ-canlerdar-days",footClass:"sign-canlerdar-footer",signClass:"signed-day",weekName:["\u65e5","\u4e00","\u4e8c","\u4e09","\u56db","\u4e94","\u516d"],reqUrl:SITEURL+"forum.php?mod=Ajax_CalendarCheckV3&action=",initCallback:function(){},callback:function(){},from:0};var m=a.extend({},i,g||{});var e=function(B,D){var C=document.createElement("script");if(C.readyState){C.onreadystatechange=function(){if(C.readyState=="loaded"||C.readyState=="complete"){C.onreadystatechange=null;s.push(B);D()}}}else{C.onload=function(){s.push(B);D()}}C.src=B;document.body.appendChild(C)};var h=function(J,F){var L=new Date(J,F,0).getDate();var G=new Date(J,F-1,1).getDay();var I=Math.ceil((L+G)/7);var K="";for(var E=0;E<I;E++){K+="<tr>";for(var D=0;D<7;D++){var C=E*7+D;var H=(C<G||C>L+G-1)?"&nbsp;":C-G+1;var B=(H=="&nbsp;")?"d_0":"d_"+H;K+='<td class="'+B+'">'+H+"</td>"}K+="</tr>"}return K};var b=function(E,B){var D='<table class="'+m.tableClass+'">';D+='<thead align="center">';D+='<tr class="'+m.headTrClass+'">';for(var C=0;C<7;C++){D+="<td>"+m.weekName[C]+"</td>"}D+="</tr></thead>";D+='<tbody align="center" id="calendarBody" class="'+m.bodyClass+'">';D+=h(m.year,m.month);D+="</tbody>";D+='<tfoot align="center" class="'+m.footClass+'"><tr>';D+='<td colspan="7" class="sign-succ-info">\u5df2\u7ecf\u8fde\u7eed\u7b7e\u5230\uff1a<c data-role="signKeepNum" class="sign-succ-count-span j-sign-succ-keep">'+E+"</c>\u5929&nbsp;&nbsp;";D+='\u7d2f\u8ba1\u7b7e\u5230\uff1a<c class="sign-succ-count-span j-sign-succ-count" data-role="signTotalNum">'+B+"</c>\u5929</td>";D+="</tr></tfoot></table>";return D};var q=function(){a("#calendarSignLayer").remove();var B='<div id="calendarSignLayer" class="signed-info" style="display: none;"> <i class="triangle"></i>           ';r();B+='<div class="sign-succ-calendar">                         <div class="sign-succ-calendar-title clearfix">                            <div class="calendar-title-month">                               <div class="calendar-month-prev j-calendar-month-prev" id="calendarPrevMonth">&nbsp;</div>                                <div class="calendar-month-span j-calendar-month" id="calendarDate">'+k+"\u5e74"+p+'\u6708</div>                                <div class="calendar-month-next j-calendar-month-next" id="calendarNextMonth">&nbsp;</div>                            </div>                            <b>\u7b7e\u5230\u65e5\u8bb0</b> </div>';B+=b(0,0);B+="</div></div>";a("[data-role=calendarSignTarget]").append(B)};var u=function(B){e("/static/js/jquery.cookie.js",function(){var C=a.cookie("zol:sign:isShowMissTips");if(C||!B){return}var D='<i class="sign-tip-close">\u5173\u95ed</i>';D+=(B>=5)?"\u60a8\u6709\u6f0f\u7b7e\uff0c\u5feb\u6765\u8865\u7b7e\u5427~":"\u6f0f\u7b7e"+B+"\u5929\uff0c\u5feb\u6765\u8865\u7b7e\u5427>>";a("#signMissTips").html(D).fadeIn();a("#signMissTips i").click(function(){a("#signMissTips").fadeOut();a.cookie("jrzj:sign:isShowMissTips",7,{expires:24});a("#calendarSignLayer").fadeIn()})})};var x=function(){var B="initSign&callback=?";a.getJSON(m.reqUrl+B,{},function(F){if(F.isSignIn&&m.from!="cms"){a('[data-role="calendarSign"]').html('<a href="javascript:void(0);" class="sign_hts">已签到</a>');q();c(F.signKeep);n(F.signInfo);m.initCallback()}a(".z_todaySignNum").text(F.signOrder);if(m.from=="cms"){q();c(F.signKeep);n(F.signInfo);if(F.isSignIn){m.initCallback()}var E="getTodaySignTotal&callback=?";a.getJSON(m.reqUrl+E,{},function(G){if(G.info="ok"){a(".z_todaySignNum").text(G.todayTotal)}});a("#calendarSignLayer").show()}a("[data-role=signKeepNum]").text(F.signKeep);a("[data-role=signTotalNum]").text(F.signTotal);a("[data-role=nextSignScore]").text(F.nextScore);u(F.signMiss)});};var A=function(){var B="";e("/static/js/jquery.cookie.js",function(){var C=a.cookie("jrzj:sign:signGuide");if(!C){B+='<div class="sign-guide"><span onclick="javascript:$(this).parent().remove();$(\'#calendarSignLayer\').show();">\u6211\u77e5\u9053\u4e86</span></div>';a.cookie("zol:sign:signGuide",1,{expires:24})}else{B+="";a.cookie("zol:sign:signGuide",1,{expires:24})}});return B};var o=function(){var B='<div class="signed-rights" id="signKeepRights">	                            <span class="signed-rights-ico signed-rights-ico-1"></span>	                            <span class="signed-rights-ico signed-rights-ico-2"></span>	                            <span class="signed-rights-ico signed-rights-ico-3"></span>	                            <div class="signed-rights-tip signed-rights-tip-1" style="display:none;"><i></i>\u8fde\u7eed\u7b7e\u52302\u5929\u53ef\u591a\u514d\u8d39\u73a91\u6b21\u8f6c\u76d8\uff01</div>	                            <div class="signed-rights-tip signed-rights-tip-2" style="display:none;"><i></i>\u8fde\u7eed\u7b7e\u52305\u5929\u53ef\u83b7\u5f97\u201c\u6d3b\u8dc3\u7cbe\u82f1\u201d\u52cb\u7ae0\uff01</div>	                            <div class="signed-rights-tip signed-rights-tip-3" style="display:none;"><i></i>\u8fde\u7eed\u7b7e\u523015\u5929\u53ef\u8ba9\u540d\u5b57\u53d8\u4e3a\u5c0a\u8d35\u6a59\u8272\uff01</div>	                        </div>';return B};var r=function(){var B="getPrizeInfo&callback=?";a.getJSON(m.reqUrl+B,{},function(D){if(D.info=="ok"){var C='<div class="pro-to-change" id="calendarPrize">				                        <div class="pro-to-change-head">				                            <a href="http://jindou.zol.com/about.html" target="_blank" class="help-link">\u5e2e\u52a9</a>				                            <h4>\u79ef\u5206\u5151\u6362</h4>				                        </div>				                        <div class="pro-intro clearfix">';C+='<a class="pic" href="'+D.goodsUrl+'" target="_blank" ><img width="97" height="60" src="'+D.goodsPic+'" alt=""></a>';C+='<h4><a href="'+D.goodsUrl+'" target="_blank">'+D.goodsName+"</a></h4>";C+="</div></div>";C+='<a class="go-draw" href="'+D.goodsUrl+'" target="_blank">\u5151\u5956</a>';a("#signKeepRights").parent().after(C)}})};var z=function(){var B="signIn&callback=?";a.getJSON(m.reqUrl+B,{},function(C){if(C.info=="ok"){q();var D=A();a("#calendarSignLayer").before(D);a(".z_todaySignNum").text(C.signOrder);a("[data-role=calendarSign]").html('<a href="javascript:void(0);" class="sign_hts">已签到</a>');a("[data-role=signKeepNum]").text(C.signKeep);a("[data-role=signTotalNum]").text(C.signTotal);a("[data-role=nextSignScore]").text(C.nextScore);c(C.signKeep);n(C.signInfo);m.callback(C.signScore);a("#calendarSignLayer").show()}})};var v=function(F){var D=parseInt(a("#calendarSignLayer #calendarDate").text().substr(0,4));var E=parseInt(a("#calendarSignLayer #calendarDate").text().substr(5,2));var C=parseInt(F.text());var B="missSignIn&callback=?";a.getJSON(m.reqUrl+B,{y:D,m:E,d:C},function(H){if(H.missSign){a("[data-role=signKeepNum]").text(H.signKeep);a("[data-role=signTotalNum]").text(H.signTotal);a("[data-role=nextSignScore]").text(H.nextScore);var G=parseInt(a("[data-role=jinDouNum]").text());if(!!G){a("[data-role=jinDouNum]").text(parseInt(G-d))}F.removeClass();F.addClass(m.signClass);F.unbind()}else{alert("\u60a8\u7684\u91d1\u8c46\u4e0d\u8db3~")}})};var c=function(C){if(C>=2){a("#signKeepRights .signed-rights-ico-1").addClass("signed-rights-get")}if(C>=5){a("#signKeepRights .signed-rights-ico-2").addClass("signed-rights-get")}if(C>=15){a("#signKeepRights .signed-rights-ico-3").addClass("signed-rights-get")}var B=[1,2,3];a.each(B,function(D,F){var G="#signKeepRights .signed-rights-ico-"+F;var E=".signed-rights-tip-"+F;a(G).hover(function(){a(this).siblings(E).show()},function(){a(this).siblings(E).hide()})});a("#calendarSignLayer").hover(function(){clearTimeout(j.i);clearTimeout(j.m);clearTimeout(j.n);clearTimeout(j.k);a("#calendarSignLayer").show()},function(){j.j=setTimeout(function(){if(m.from!="cms"){a("#calendarSignLayer").hide()}a("#missSignTips").hide();a("#missSignConfirm").hide()},200)});a("#missSignConfirm ,#missSignTips").hover(function(){clearTimeout(j.j);a("#calendarSignLayer").show()},function(){if(m.from=="cms"){return false}j.k=setTimeout(function(){a("#calendarSignLayer").hide()},200)});a("#missSignConfirm").hover(function(){clearTimeout(j.o);a("#calendarSignLayer").show()},function(){a(this).hide();if(m.from=="cms"){return false}j.n=setTimeout(function(){a("#calendarSignLayer").hide()},200)});a("#calendarSignLayer #calendarPrevMonth").bind("click",function(){var E=a("#calendarSignLayer #calendarDate").text();var I=parseInt(E.substring(0,4));var D=parseInt(E.substring(5,7));var H=(D==1)?12:D-1;var G=(D==1)?I-1:I;if(H<10){H="0"+H}if(2013==I&&D==4){return false}var F=h(I,H);a("#calendarBody").empty().append(F);a("#calendarSignLayer #calendarDate").text(G+"\u5e74"+H+"\u6708");l(I,H)});a("#calendarSignLayer #calendarNextMonth").bind("click",function(){var E=a("#calendarSignLayer #calendarDate").text();var I=parseInt(E.substring(0,4));var D=parseInt(E.substring(5,7));var H=(D==12)?1:D+1;var G=(D==12)?I+1:I;if(H<10){H="0"+H}if(k==I&&y==D){return false}var F=h(I,H);a("#calendarBody").empty().append(F);a("#calendarSignLayer #calendarDate").text(G+"\u5e74"+H+"\u6708");l(I,H)})};var l=function(D,C){var B="getSignDaysInfo&callback=?";a.getJSON(m.reqUrl+B,{y:D,m:C},function(E){n(E)})};var n=function(G){var E="";if(typeof G=="object"){a.each(G,function(I,M){var J=".d_"+M.day;var K=a("#calendarBody").find(J);var L="";K.addClass(m.signClass);if(M.resign){L="\u4e8e"+M.check_date.substr(0,10)+"\u8865\u7b7e"}else{L="\u4e8e"+M.time;if(0){L+=",\u7b2c"+M.order+"\u4e2a"}L+="\u7b7e\u5230"}K.attr("title",L)});var C=a("#calendarSignLayer #calendarDate").text();var H=parseInt(C.substring(0,4));var B=C.substr(5,2);if(k==H&&p==B){var D=parseInt(t+a("#calendarBody tr").first().find(".d_0").length);var F=a("#calendarBody td").slice(0,D).not(".d_0").not("."+m.signClass)}else{var F=a("#calendarBody td").not(".d_0").not("."+m.signClass)}F.bind({mouseenter:function(){a(this).addClass("date-hover");var J=parseInt(a(this).offset().top)-35;var I=parseInt(a(this).offset().left)-41;if(a(window).width()-parseInt(a(this).offset().left)<=60){I=a(window).width()-117;a("#missSignTips i").css("left","65%")}else{a("#missSignTips i").css("left","50%")}a("#missSignTips").css({top:J,left:I});a("#missSignTips").show()},mouseleave:function(){a(this).removeClass("date-hover");a("#missSignTips").hide()}});F.bind("click",function(){a(this).removeClass("date-hover");a(this).addClass("date-select");a("#missSignTips").hide();E=a(this);var J=parseInt(a(this).offset().top)-35;var I=parseInt(a(this).offset().left)-34;a("#missSignConfirm").css({top:J,left:I});a("#missSignConfirm").show();E.unbind("mouseleave");E.mouseleave(function(){j.o=setTimeout(function(){E.removeClass("date-select");a("#missSignConfirm").hide()},300)});a("#missSignConfirm .sure").unbind();a("#missSignConfirm .sure").click(function(K){K.preventDefault();v(E);a("#missSignConfirm").hide()});a("#missSignConfirm .cancel").click(function(){E.removeClass("date-select");a("#missSignConfirm").hide()});a("#missSignConfirm").mouseleave(function(){E.removeClass("date-select");a("#missSignConfirm").hide()})})}};var f=function(){var B="getTodaySignTotal&callback=?";a.getJSON(m.reqUrl+B,{},function(C){if(C.info="ok"){a(".z_todaySignNum").text(C.todayTotal)}})};return this.each(function(){var B=a(this);x();a(this).bind("click",function(){z()});if(m.from!="cms"){a(this).hover(function(){clearTimeout(j.j);f();a("#calendarSignLayer").show()},function(){j.i=setTimeout(function(){a("#calendarSignLayer").hide()},200)})}})}}
        )(jQuery);